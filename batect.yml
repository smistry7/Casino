containers:
  dotnet-sdk-container:
    image: mcr.microsoft.com/dotnet/sdk:6.0
    ports:
      - 5001:80
    volumes:
      - local: .
        container: /code
      - type: cache
        name: nuget-cache
        container: /root/.nuget/packages
    working_directory: /code/src/

  sql-server-container:
    build_directory: ./.batect/sql-server
    volumes:
      - local: .
        container: /code/
        options: cached
    working_directory: /code
    ports:
      - "8123:1433"

tasks:

  build-app:
    description: dotnet build the api
    run:
      container: dotnet-sdk-container
      command: dotnet build Casino.Api



  run-app:
    description: run casino app
    run:
      container: dotnet-sdk-container
      command: sh -c "dotnet dev-certs https --clean && dotnet dev-certs https -t && dotnet run --project ./Casino.Api/Casino.Api.csproj --no-build"
    dependencies:
      - sql-server-container
    prerequisites: 
      - build-app